#!/bin/bash

# This is the "frontend script" to be called by the user, which delegates the actual work to the scripts in subfolder "mr4b_includes".


function HINT_HELP_COMMAND() {
    echo -e "Call 'mr4b help' for list of commands.\n"
}


# So far exactly one command must be specified
if [ $# -ne 1 ]
then
    echo -e "\nInvalid call without command."
    HINT_HELP_COMMAND
    exit
fi

readonly COMMAND_STRING=$1

readonly VERSION_OF_MR4B=1.0


# Variable to be read by called scripts
readonly REPO_LIST_FILE=~/.mr4b_repos


# Register Git repo in current folder
if [ $COMMAND_STRING == "register" ]
then
    source $(dirname "$0")/mr4b_includes/mr4b_RegisterRepo.sh # https://stackoverflow.com/questions/38978650/
    exit
fi

if [ $COMMAND_STRING == "registerRecursively" ]
then
    source $(dirname "$0")/mr4b_includes/mr4b_RegisterRecursively.sh
    exit
fi

# Execute a Git command on all repositories
if [ $COMMAND_STRING == "pull"   -o \
     $COMMAND_STRING == "fetch"  -o \
     $COMMAND_STRING == "merge"  -o \
     $COMMAND_STRING == "status" -o \
     $COMMAND_STRING == "gc" ]
then
    source $(dirname "$0")/mr4b_includes/mr4b_ExecuteCommandOnAllRepos.sh $COMMAND_STRING
    exit
fi

# Now handle the commands which are directly implemented in this script

if [ $COMMAND_STRING == "version" ]
then
    echo -e "\nVersion "${VERSION_OF_MR4B}" of mr4b."
    exit
fi

if [ $COMMAND_STRING == "help" ]
then
    cat $(dirname "$0")/mr4b_includes/mr4b_help.txt
    exit
fi

echo -e "\nUnknown command '"${COMMAND_STRING}"'.\n"
HINT_HELP_COMMAND
